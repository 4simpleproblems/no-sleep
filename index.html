<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VERN Calm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the page and interactive elements */
        body {
            font-family: 'Lora', serif;
            -webkit-tap-highlight-color: transparent; /* Disable tap highlight on mobile */
        }

        /* Custom styling for range sliders */
        .custom-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 20px;
            background: #D1C7B8; /* Softer track color */
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
            border-radius: 12px;
        }
        .custom-slider:hover { opacity: 1; }
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            background: #A69B8B;
            cursor: pointer;
            border-radius: 50%;
            border: 4px solid #F5F0E8;
        }
        .custom-slider::-moz-range-thumb {
            width: 35px;
            height: 35px;
            background: #A69B8B;
            cursor: pointer;
            border-radius: 50%;
            border: 4px solid #F5F0E8;
        }

        /* Styles for the knobbed slider */
        .knob-slider-container { position: relative; width: 100%; height: 50px; display: flex; align-items: center; justify-content: center; padding: 20px 0; }
        .knob-track { position: absolute; width: 100%; height: 8px; background-color: #D1C7B8; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .knob-notch { width: 20px; height: 20px; background-color: #D1C7B8; border-radius: 50%; }
        .knob { position: absolute; left: 0; width: 40px; height: 40px; background-color: #A69B8B; border-radius: 50%; cursor: grab; border: 5px solid #F5F0E8; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 10; transition: transform 0.2s ease-out; }
        .knob:active { cursor: grabbing; }
        
        /* Styles for the Toggle Switch */
        .toggle-switch { width: 80px; height: 40px; background-color: #D1C7B8; border-radius: 20px; padding: 4px; cursor: pointer; transition: background-color 0.3s ease; }
        .toggle-switch.on { background-color: #A69B8B; }
        .toggle-knob { width: 32px; height: 32px; background-color: white; border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.2); transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .toggle-switch.on .toggle-knob { transform: translateX(40px); }

        /* Styles for the Pop Buttons */
        .pop-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; width: 240px; }
        .pop-button { width: 100%; padding-bottom: 100%; position: relative; border-radius: 30%; background-color: #D1C7B8; cursor: pointer; transition: transform 0.1s ease, background-color 0.1s ease; }
        .pop-button:active { transform: scale(0.9); background-color: #A69B8B; }
        
        /* Styles for the Number Slider */
        .number-slider-container .number-display {
            font-size: 3rem;
            font-weight: 600;
            color: #8b8071;
            min-height: 60px;
        }
        
        /* Styles for the Breathing Animation */
        .breathing-circle {
            width: 150px;
            height: 150px;
            background-color: #bfaea0;
            border-radius: 50%;
            animation: breathe 8s ease-in-out infinite;
            cursor: pointer;
        }
        @keyframes breathe {
            0%, 100% { transform: scale(0.9); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

    </style>
</head>
<body class="bg-[#F5F0E8] text-[#5a5245]">

    <div class="min-h-screen w-full flex flex-col items-center justify-center p-4 lg:p-8 space-y-8">

        <h1 class="text-4xl sm:text-5xl font-medium text-center">VERN Calm</h1>

        <!-- Main container for all interactive elements -->
        <div class="w-full max-w-7xl mx-auto p-6 lg:p-10 bg-[#EAE3D9] rounded-3xl shadow-lg flex flex-col lg:flex-row flex-wrap justify-center items-center lg:items-start gap-y-10 gap-x-8">

            <!-- Group 1: Breathing and Pop Buttons -->
            <div class="flex flex-col items-center space-y-10">
                 <div class="text-center">
                    <h2 class="text-xl mb-4">Breathing Circle</h2>
                    <div id="breathingCircle" class="breathing-circle"></div>
                </div>
                <div class="text-center">
                    <h2 class="text-xl mb-4">Pop Buttons</h2>
                    <div id="popGrid" class="pop-grid"></div>
                </div>
            </div>

            <!-- Group 2: Sliders and Toggles -->
            <div class="w-full sm:w-80 lg:w-1/3 flex-shrink-0 flex flex-col space-y-12 pt-2">
                <div class="text-center">
                    <h2 class="text-xl mb-4">Number Slider</h2>
                    <div class="number-slider-container">
                        <p id="numberDisplay" class="number-display">50</p>
                        <input type="range" id="numberSlider" min="0" max="100" value="50" class="custom-slider">
                    </div>
                </div>
                <div class="text-center">
                    <h2 class="text-xl mb-4">Knob Slider</h2>
                    <div id="knobSlider" class="knob-slider-container">
                        <div class="knob-track"></div>
                        <div id="knob" class="knob"></div>
                    </div>
                </div>
                 <div class="text-center">
                    <h2 class="text-xl mb-4">Switch</h2>
                    <div id="toggleSwitch" class="toggle-switch mx-auto">
                        <div class="toggle-knob"></div>
                    </div>
                </div>
            </div>

             <!-- Group 3: Big Button -->
            <div class="flex flex-col items-center text-center">
                <h2 class="text-xl mb-4">Button</h2>
                <button id="soundButton" class="w-28 h-28 sm:w-32 sm:h-32 bg-[#A69B8B] rounded-full shadow-md active:shadow-inner active:scale-95 transition-all focus:outline-none"></button>
            </div>
        </div>
        
        <p class="text-center text-sm text-gray-500">A quiet place for gentle interaction.</p>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Sound Engine (using Tone.js) ---
            const baseSynth = new Tone.MembraneSynth({ pitchDecay: 0.02, octaves: 2, oscillator: { type: "sine" }, envelope: { attack: 0.01, decay: 0.3, sustain: 0.01, release: 0.2 } }).toDestination();
            const bellSynth = new Tone.MetalSynth({ frequency: 250, envelope: { attack: 0.001, decay: 0.4, release: 0.2 }, harmonicity: 5.1, modulationIndex: 32, resonance: 4000, octaves: 1.5 }).toDestination();
            const breathSound = new Tone.NoiseSynth({ noise: { type: 'pink' }, envelope: { attack: 1, decay: 1, sustain: 0.1, release: 1 } }).toDestination();
            breathSound.volume.value = -20; // Make it quiet

            function playSound(note = 'C2', duration = '8n', synth = baseSynth) {
                if (Tone.context.state !== 'running') { Tone.start(); }
                synth.triggerAttackRelease(note, duration);
            }

            // --- Speech Synthesis ---
            let speechUtterance = new SpeechSynthesisUtterance();
            speechUtterance.lang = 'en-US';
            speechUtterance.rate = 0.9;
            speechUtterance.pitch = 1.1;
            function speak(text) {
                if (speechSynthesis.speaking) return; // Don't interrupt
                speechUtterance.text = text;
                window.speechSynthesis.speak(speechUtterance);
            }

            // --- Breathing Circle ---
            const breathingCircle = document.getElementById('breathingCircle');
            breathingCircle.addEventListener('click', () => {
                if (breathSound.volume.value === -20) {
                    breathSound.triggerAttack();
                    breathSound.volume.rampTo(0, 4);
                    setTimeout(() => breathSound.volume.rampTo(-20, 4), 4000);
                    setTimeout(() => breathSound.triggerRelease(), 8000);
                }
            });

            // --- Pop Buttons Interaction ---
            const popGrid = document.getElementById('popGrid');
            const popNotes = ['C5', 'E5', 'G5', 'A5', 'C6', 'D5', 'F5', 'B5', 'D6'];
            for (let i = 0; i < 9; i++) {
                const popButton = document.createElement('div');
                popButton.className = 'pop-button';
                const note = popNotes[i];
                const playPopSound = () => playSound(note, '16n', bellSynth);
                popButton.addEventListener('mousedown', playPopSound);
                popButton.addEventListener('touchstart', (e) => { e.preventDefault(); playPopSound(); }, { passive: false });
                popGrid.appendChild(popButton);
            }

            // --- Number Slider Interaction ---
            const numberSlider = document.getElementById('numberSlider');
            const numberDisplay = document.getElementById('numberDisplay');
            let speakTimeout;
            numberSlider.addEventListener('input', () => {
                const num = numberSlider.value;
                numberDisplay.textContent = num;
                // Speak the number, but debounce to avoid spamming
                clearTimeout(speakTimeout);
                speakTimeout = setTimeout(() => speak(num), 300);
            });

            // --- Knobbed Slider Interaction ---
            const knobSlider = document.getElementById('knobSlider');
            const knob = document.getElementById('knob');
            const track = knobSlider.querySelector('.knob-track');
            const numNotches = 5;
            for (let i = 0; i < numNotches; i++) { track.appendChild(document.createElement('div')).className = 'knob-notch'; }
            let active = false, currentX, lastStep = 0, sliderWidth, stepWidth;

            function updateKnobSliderDimensions() {
                sliderWidth = track.offsetWidth;
                if(sliderWidth > 0){
                    stepWidth = sliderWidth / (numNotches - 1);
                    const currentStep = lastStep;
                    const newPosition = (currentStep * stepWidth) - (knob.offsetWidth / 2);
                    setTranslate(newPosition, knob);
                }
            }
            updateKnobSliderDimensions();
            
            function dragStart(e) { if (e.target === knob) { e.preventDefault(); active = true; knob.style.cursor = 'grabbing'; } }
            function dragEnd(e) {
                if (!active) return;
                active = false; knob.style.cursor = 'grab';
                const finalPosition = knob.getBoundingClientRect().left - track.getBoundingClientRect().left + (knob.offsetWidth / 2);
                const step = Math.round(finalPosition / stepWidth);
                const snapX = (step * stepWidth) - (knob.offsetWidth / 2);
                setTranslate(snapX, knob); lastStep = step;
            }
            function drag(e) {
                if (!active) return; e.preventDefault();
                let clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                const sliderRect = knobSlider.getBoundingClientRect();
                currentX = clientX - sliderRect.left - (knob.offsetWidth / 2);
                const minX = -knob.offsetWidth / 2, maxX = sliderWidth - knob.offsetWidth / 2;
                currentX = Math.max(minX, Math.min(currentX, maxX));
                setTranslate(currentX, knob);
                const currentStep = Math.round((currentX + knob.offsetWidth / 2) / stepWidth);
                if (currentStep !== lastStep) { playSound('C2', '32n'); lastStep = currentStep; }
            }
            function setTranslate(xPos, el) { el.style.transform = `translateX(${xPos}px)`; }
            ['touchstart', 'mousedown'].forEach(evt => knobSlider.addEventListener(evt, dragStart, { passive: false }));
            ['touchend', 'mouseup', 'mouseleave'].forEach(evt => document.addEventListener(evt, dragEnd));
            ['touchmove', 'mousemove'].forEach(evt => document.addEventListener(evt, drag, { passive: false }));
            window.addEventListener('resize', updateKnobSliderDimensions);
            window.addEventListener('load', updateKnobSliderDimensions);

            // --- Toggle Switch Interaction ---
            const toggleSwitch = document.getElementById('toggleSwitch');
            toggleSwitch.addEventListener('click', () => {
                const isOn = toggleSwitch.classList.toggle('on');
                playSound(isOn ? 'E3' : 'C3', '16n');
            });

            // --- Big Button Interaction ---
            const soundButton = document.getElementById('soundButton');
            soundButton.addEventListener('click', () => playSound('G2', '16n'));
            soundButton.addEventListener('touchstart', (e) => { e.preventDefault(); playSound('G2', '16n'); }, { passive: false });
        });
    </script>

</body>
</html>
